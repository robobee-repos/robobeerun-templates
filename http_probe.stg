/*
 * Adds readiness and liveless probes to Nginx.
 * 
 * Optional:
 * 
 * vars.livenessProbe.port
 *     Defaults to http.
 * vars.livenessProbe.initialDelaySeconds
 *     Defaults to 60.
 * vars.readinessProbe.port
 *     Defaults to http.
 * vars.readinessProbe.initialDelaySeconds
 *     Defaults to 60.
 * vars.httpHeaders[]
 *     A map of optional HTTP headers.
 * vars.httpHeaders[].name
 * vars.httpHeaders[].value
 * 
 * Example:
 * 
 * import "robobeerun-templates/http_probe.stg"
 * 
 * cc-keycloak-deploy-yaml(parent, vars) ::= <<
 * apiVersion: extensions/v1beta1
 * kind: Deployment
 * ...
 *       - image:
 *         name:
 *         ports:
 *         - containerPort: 8080
 *           name: http
 *         <httpReadinessProbeGroup(vars.keycloak)>
 * ...
 * >>
 */

/*
 *
 */
httpReadinessProbeGroup(vars) ::= <<
livenessProbe:
  tcpSocket:
    port: <if(vars.livenessProbe.port)><vars.livenessProbe.port><else>http<endif>
  initialDelaySeconds: <if(vars.livenessProbe.initialDelaySeconds)><vars.livenessProbe.initialDelaySeconds><else>60<endif>
  periodSeconds: 60
  timeoutSeconds: 10
readinessProbe:
  httpGet:
    path: /
    port: <if(vars.readinessProbe.port)><vars.readinessProbe.port><else>http<endif>
    <httpHeaders(vars.httpHeaders)>
  initialDelaySeconds: <if(vars.readinessProbe.initialDelaySeconds)><vars.readinessProbe.initialDelaySeconds><else>60<endif>
  periodSeconds: 60
  timeoutSeconds: 10
>>

httpHeaders(headers) ::= <<
<if(headers)>
httpHeaders:
  <headers:httpHeader()>
<endif>
>>

httpHeader(header) ::= <<
- name: <header.name>
  value: <header.value>
>>
